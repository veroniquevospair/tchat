<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <title>Partie Multijoueur avec Chat</title>
</head>
<body>
    <style>
    /* Typographie et couleurs générales */
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: #f4f6f8;
        color: #333;
        margin: 0;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    h1, h2 {
        color: #222;
        text-align: center;
        margin-bottom: 15px;
    }

    /* Inputs et boutons */
    input[type="text"] {
        padding: 10px;
        margin: 5px 0;
        width: 250px;
        border: 1px solid #ccc;
        border-radius: 8px;
        outline: none;
        transition: border 0.3s, box-shadow 0.3s;
    }

    input[type="text"]:focus {
        border-color: #4a90e2;
        box-shadow: 0 0 5px rgba(74, 144, 226, 0.5);
    }

    button {
        padding: 10px 20px;
        margin: 5px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        background-color: #4a90e2;
        color: #fff;
        font-weight: bold;
        transition: background-color 0.3s, transform 0.2s;
    }

    button:hover:not(:disabled) {
        background-color: #357ABD;
        transform: translateY(-2px);
    }

    button:disabled {
        background-color: #ccc;
        cursor: not-allowed;
    }

    /* Listes */
    ul {
        list-style: none;
        padding: 0;
        width: 300px;
    }

    li {
        background: #fff;
        padding: 10px;
        margin-bottom: 8px;
        border-radius: 8px;
        box-shadow: 0 1px 4px rgba(0,0,0,0.1);
        transition: transform 0.2s;
    }

    li:hover {
        transform: scale(1.02);
    }

    /* Zone de messages */
    #messages {
        max-height: 200px;
        overflow-y: auto;
        border: 1px solid #ddd;
        padding: 10px;
        background: #fff;
        border-radius: 8px;
        width: 300px;
    }

    #messages li {
        background: #e7f0fd;
    }

    /* Conteneur général */
    .container {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .input-group {
        display: flex;
        flex-direction: row;
        margin-bottom: 10px;
    }

    .input-group input {
        flex: 1;
    }
</style>

    <h1>Entrée dans la partie</h1>
    <input type="text" id="nom" placeholder="Votre nom" />
    <button id="entrerBtn">Entrer</button>
    <button id="sortirBtn" disabled>Sortir</button>

    <h2>Joueurs dans la partie :</h2>
    <ul id="listeJoueurs"></ul>

    <h2>Messagerie</h2>
    <input type="text" id="inputMessage" placeholder="Écrire un message..." />
    <button id="btnEnvoyer">Envoyer</button>
    <ul id="messages" style="max-height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 5px;"></ul>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();

        const entrerBtn = document.getElementById('entrerBtn');
        const sortirBtn = document.getElementById('sortirBtn');
        const nomInput = document.getElementById('nom');
        const listeJoueurs = document.getElementById('listeJoueurs');

        const inputMessage = document.getElementById('inputMessage');
        const btnEnvoyer = document.getElementById('btnEnvoyer');
        const messages = document.getElementById('messages');

        let joueurLocal = null;

        entrerBtn.onclick = () => {
            const nom = nomInput.value.trim();
            if (nom) {
                socket.emit('entrer', nom);
            }
        };

        sortirBtn.onclick = () => {
            socket.emit('sortir');
            joueurLocal = null;
            entrerBtn.disabled = false;
            sortirBtn.disabled = true;
            // Optionnel: vider la liste de messages et joueurs ?
            // messages.innerHTML = '';
            // listeJoueurs.innerHTML = '';
        };

        btnEnvoyer.onclick = () => {
            const message = inputMessage.value.trim();
            if (message && joueurLocal) {
                socket.emit('nouveauMessage', message);
                inputMessage.value = '';
            }
        };

        socket.on('entreeConfirmee', (joueur) => {
            joueurLocal = joueur;
            alert(`Bienvenue ${joueur.nom}`);
            entrerBtn.disabled = true;
            sortirBtn.disabled = false;
        });

        socket.on('majJoueurs', (joueurs) => {
            listeJoueurs.innerHTML = '';
            joueurs.forEach((j, index) => {
                const li = document.createElement('li');
                li.textContent = `#${index + 1} - ${j.nom}`;
                listeJoueurs.appendChild(li);
            });
        });

        socket.on('messageDiffuse', (message) => {
            const li = document.createElement('li');
            li.textContent = message;
            messages.appendChild(li);
            messages.scrollTop = messages.scrollHeight;
        });

        socket.on('erreur', (msg) => {
            alert(msg);
        });
    </script>
</body>
</html>
